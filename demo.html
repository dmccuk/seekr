<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seekr.run, Gameplay demo</title>
  <meta name="description" content="Seekr.run gameplay demo, set a game area, rules, and get a code" />
  <link rel="icon" type="image/x-icon" href="assets/seekr-favicon.ico" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    :root{
      --ink:#0e1220; --muted:#55627a; --bg:#f6f8fc; --card:#ffffff;
      --brand:#1e4cff; --accent:#35c18f; --line:#e7ecf3;
      --good:#1f7a48; --bad:#b00020;
    }
    *{ box-sizing:border-box }
    html, body{ height:100% }
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height:1.35;
    }
    .shell{ max-width:1100px; margin:0 auto; padding:24px 16px 48px }
    header{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:16px }
    .brand{ font-weight:800; letter-spacing:.4px }
    .subtle{ color:var(--muted); font-size:13px }

    .grid{ display:grid; grid-template-columns:1.2fr .8fr; gap:18px; }
    @media (max-width:900px){ .grid{ grid-template-columns:1fr } }

    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:14px; padding:14px; box-shadow:0 8px 22px rgba(20,32,70,.06);
    }
    .card h2{ margin:4px 0 10px 0; font-size:18px; font-weight:800 }
    .row{ display:flex; gap:10px; align-items:center }
    label{ font-size:13px; color:var(--muted) }
    input[type="text"], input[type="number"], select{
      border:1px solid var(--line); border-radius:10px; padding:10px 12px; font-family:inherit;
      background:#fff; width:100%;
    }
    .switch{
      display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none;
      font-size:13px; color:var(--ink);
    }
    .switch input{ display:none }
    .track{
      width:46px; height:26px; background:#d7deea; border-radius:999px; position:relative; transition:background .2s;
    }
    .dot{
      position:absolute; top:3px; left:3px; width:20px; height:20px; border-radius:50%;
      background:#fff; box-shadow:0 1px 4px rgba(0,0,0,.2); transition:left .2s;
    }
    .switch input:checked + .track{ background:#26a269 }
    .switch input:checked + .track .dot{ left:23px }

    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 14px; font-weight:800; color:#fff;
      background:linear-gradient(135deg,#4facfe,#00f2fe); cursor:pointer; box-shadow:0 4px 12px rgba(79,172,254,.35);
    }
    .btn.secondary{ background:linear-gradient(135deg,#8e9eab,#eef2f3); color:#0e1220; box-shadow:none }
    .btn.copy{ background:linear-gradient(135deg,#35c18f,#2bb07f) }

    .whatsapp-btn{
      background:#25D366; color:#fff; border-radius:50%; width:46px; height:46px;
      display:flex; align-items:center; justify-content:center; border:none;
      cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.15);
    }
    .whatsapp-btn:hover{ background:#20b358 }
    .whatsapp-btn svg{ width:22px; height:22px; display:block; fill:#fff; }

    .stack{ display:grid; gap:10px }
    .two{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
    @media (max-width:520px){ .two{ grid-template-columns:1fr } }

    #map{ width:100%; height:min(64vh,520px); border-radius:12px; overflow:hidden }

    .codeBox{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      background:#f7f9ff; border:1px dashed #c7d2ee; padding:10px 12px; border-radius:12px;
    }
    .code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-weight:800; letter-spacing:.12em }

    .muted{ color:var(--muted) }
    .wallet{
      display:flex; align-items:center; gap:10px; background:#f1f6f2; border:1px solid #d9eadf; padding:10px 12px; border-radius:12px;
    }
    .pill{ display:inline-block; background:#eef2fa; border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:12px; color:#55627a }

    .footnote{ margin-top:10px; font-size:12px; color:#var(--muted) }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div>
        <div class="brand">Seekr.run</div>
        <div class="subtle">Gameplay demo, set an area, configure rules, get a dummy code</div>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
        <a href="index.html" class="btn secondary">Back</a>
      </div>
    </header>

    <div class="grid">
      <!-- Map and area selection -->
      <section class="card">
        <h2>Pick your playing area</h2>
        <div id="map" role="img" aria-label="Select a game area on map"></div>
        <div class="two" style="margin-top:10px;">
          <div class="stack">
            <label for="radiusKm">Area radius, km</label>
            <input id="radiusKm" type="number" min="0.2" max="50" step="0.1" value="0.6" />
          </div>
          <div class="stack">
            <label class="muted">Center, drag the pin to move</label>
            <div class="pill" id="centerReadout">lat 0, lng 0</div>
          </div>
        </div>
        <div class="footnote">Your location is used only to center this demo map.</div>
      </section>

      <!-- Rules and dummy code -->
      <section class="card">
        <h2>Rules</h2>
        <div class="two">
          <div class="stack">
            <label for="gameLen">Game length, minutes</label>
            <input id="gameLen" type="number" min="5" max="240" step="5" value="30" />
          </div>
          <div class="stack">
            <label for="tagDist">Tag distance, meters</label>
            <input id="tagDist" type="number" min="2" max="50" step="1" value="8" />
          </div>
        </div>

        <div class="stack" style="margin-top:10px;">
          <label>Power ups</label>
          <label class="switch"><input id="puDelay" type="checkbox" checked><span class="track"><span class="dot"></span></span>Delay ping</label>
          <label class="switch"><input id="puReveal" type="checkbox" checked><span class="track"><span class="dot"></span></span>Instant reveal</label>
          <label class="switch"><input id="puGhost" type="checkbox"><span class="track"><span class="dot"></span></span>Ghost trail, short decoy path</label>
        </div>

        <div class="two" style="margin-top:10px;">
          <div class="stack">
            <label for="pingMins">Reveal ping, minutes</label>
            <input id="pingMins" type="number" min="1" max="15" step="1" value="5" />
          </div>
          <div class="stack">
            <label>Wallet</label>
            <div class="wallet">
              <strong>$2.59</strong>
              <span class="muted">demo balance</span>
            </div>
          </div>
        </div>

        <div class="stack" style="margin-top:14px;">
          <div class="codeBox">
            <div class="muted">Game code</div>
            <div id="code" class="code">AAAAAA</div>
            <button id="btnCode" class="btn copy" type="button">Generate</button>
            <!-- WhatsApp share replaces Copy -->
            <button id="btnShareWA" class="whatsapp-btn" type="button" title="Share on WhatsApp" aria-label="Share code via WhatsApp">
              <!-- Inline WhatsApp SVG -->
              <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                <path d="M19.11 17.36c-.29-.15-1.69-.83-1.95-.92-.26-.1-.45-.15-.64.15-.19.29-.74.92-.9 1.11-.17.19-.33.22-.62.07-.29-.15-1.22-.45-2.32-1.45-.86-.77-1.44-1.72-1.61-2.01-.17-.29-.02-.45.13-.6.13-.13.29-.33.43-.49.14-.16.19-.26.29-.45.1-.19.05-.37-.02-.52-.07-.15-.64-1.55-.88-2.12-.23-.56-.47-.48-.64-.49l-.55-.01c-.19 0-.49.07-.74.37-.26.29-.97.95-.97 2.31 0 1.36.99 2.67 1.13 2.86.15.19 1.95 2.98 4.73 4.18.66.29 1.18.47 1.58.6.66.21 1.26.18 1.73.11.53-.08 1.69-.69 1.93-1.35.24-.66.24-1.23.17-1.35-.07-.12-.26-.2-.55-.34zM16.02 3.2c-7.1 0-12.85 5.75-12.85 12.85 0 2.27.6 4.49 1.75 6.45L3.2 28.8l6.51-1.68a12.78 12.78 0 0 0 6.31 1.65h.01c7.1 0 12.85-5.75 12.85-12.85s-5.76-12.85-12.86-12.85zm7.53 20.38c-1.01 1.01-2.21 1.8-3.54 2.35-1.37.56-2.82.84-4.31.84h-.01c-2.27 0-4.49-.58-6.45-1.69l-.46-.26-3.86 1 1.03-3.76-.3-.49a10.63 10.63 0 0 1-1.58-5.61c0-5.88 4.78-10.66 10.66-10.66 2.85 0 5.53 1.11 7.54 3.12a10.57 10.57 0 0 1 3.12 7.54c0 1.49-.28 2.94-.84 4.31-.55 1.33-1.34 2.53-2.35 3.54z"/>
              </svg>
            </button>
          </div>
          <button id="btnStart" class="btn" type="button">Start demo round</button>
          <div id="status" class="footnote"></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // Map setup
    let map, centerMarker, areaCircle;
    const centerReadout = document.getElementById('centerReadout');
    const radiusInput = document.getElementById('radiusKm');

    function setReadout(latlng){
      centerReadout.textContent = 'lat ' + latlng.lat.toFixed(5) + ', lng ' + latlng.lng.toFixed(5);
    }

    function initMap(lat=51.505, lng=-0.09){
      map = L.map('map', { zoomControl:true, attributionControl:false });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
      const start = L.latLng(lat, lng);
      map.setView(start, 15);

      centerMarker = L.marker(start, { draggable:true }).addTo(map);
      areaCircle = L.circle(start, { radius: Number(radiusInput.value) * 1000, color:'#1e4cff', fillColor:'#1e4cff', fillOpacity:0.12 }).addTo(map);
      setReadout(start);

      centerMarker.on('drag', e => {
        const p = e.target.getLatLng();
        areaCircle.setLatLng(p);
        setReadout(p);
      });

      radiusInput.addEventListener('input', () => {
        const km = Math.max(0.2, Math.min(50, Number(radiusInput.value) || 0.6));
        areaCircle.setRadius(km * 1000);
      });
    }

    if (location.protocol === 'https:' && 'geolocation' in navigator){
      navigator.geolocation.getCurrentPosition(
        pos => initMap(pos.coords.latitude, pos.coords.longitude),
        ()  => initMap(),
        { enableHighAccuracy:true, maximumAge:60000, timeout:12000 }
      );
    }else{
      initMap();
    }

    // Demo logic
    const codeEl = document.getElementById('code');
    const btnCode = document.getElementById('btnCode');
    const btnStart = document.getElementById('btnStart');
    const statusEl = document.getElementById('status');

    function makeCode(len=6){
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let out = '';
      for(let i=0;i<len;i++){ out += chars[Math.floor(Math.random()*chars.length)]; }
      return out;
    }

    btnCode.addEventListener('click', () => {
      codeEl.textContent = makeCode();
      statusEl.textContent = 'New demo code created, share this with friends';
      statusEl.style.color = 'var(--good)';
    });

    btnStart.addEventListener('click', () => {
      const cfg = {
        center: centerMarker.getLatLng(),
        radius_km: Number(radiusInput.value),
        game_minutes: Number(document.getElementById('gameLen').value),
        tag_meters: Number(document.getElementById('tagDist').value),
        ping_minutes: Number(document.getElementById('pingMins').value),
        powerups: {
          delay: document.getElementById('puDelay').checked,
          reveal: document.getElementById('puReveal').checked,
          ghost: document.getElementById('puGhost').checked
        },
        code: codeEl.textContent
      };
      console.log('Demo config', cfg);
      statusEl.textContent = 'Demo round created, code ' + cfg.code + ', map centered to your chosen area';
      statusEl.style.color = 'var(--good)';
    });

    // WhatsApp share: includes code + URL with ?code= param
    const shareWABtn = document.getElementById('btnShareWA');

    function shareCodeAndUrl(){
      const code = codeEl.textContent.trim() || 'AAAAAA';
      const url = new URL(window.location.href);
      url.searchParams.set('code', code);
      const message = encodeURIComponent('Join my Seekr.run demo game! Code: ' + code + ' ' + url.toString());
      window.open('https://wa.me/?text=' + message, '_blank');
    }

    shareWABtn.addEventListener('click', shareCodeAndUrl);
  </script>
</body>
</html>
