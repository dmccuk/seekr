<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seekr.run ‚Äî Gameplay demo</title>
  <meta name="description" content="Seekr.run gameplay demo ‚Äî set a zone, configure rules, and get a dummy code" />
  <link rel="icon" type="image/x-icon" href="assets/seekr-favicon.ico" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800;900&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    :root{
      --ink:#0e1220; --muted:#55627a; --bg:#f6f8fc; --card:#ffffff;
      --brand:#1e4cff; --accent:#35c18f; --line:#e7ecf3;
      --good:#1f7a48; --bad:#b00020;
    }
    *{ box-sizing:border-box }
    html, body{ height:100% }
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height:1.35;
    }
    .shell{ max-width:1100px; margin:0 auto; padding:24px 16px 56px }

    /* Header ‚Äî matches index look */
    header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px }
    .brand{
      font-weight:900; font-size:32px; letter-spacing:.6px; line-height:1.1; color:var(--ink);
      text-shadow:0 2px 10px rgba(30,76,255,.12), 0 1px 0 #fff;
    }
    .tag{
      display:inline-block; margin-top:6px; font-size:14px; font-weight:600; color:var(--muted);
      padding:6px 10px; border-radius:999px; background:linear-gradient(180deg,#fff,#f7f9ff); border:1px solid var(--line);
      box-shadow:0 6px 18px rgba(20,32,70,.06);
    }

    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 14px; font-weight:800; color:#fff;
      background:linear-gradient(135deg,#4facfe,#00f2fe); cursor:pointer; box-shadow:0 4px 12px rgba(79,172,254,.35);
      text-decoration:none; display:inline-block;
    }
    .btn.secondary{ background:linear-gradient(135deg,#8e9eab,#eef2f3); color:#0e1220; box-shadow:none }

    /* How it works strip */
    .hiw{
      display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin:8px 0 16px 0;
    }
    .hiw .chip{
      background:#fff; border:1px solid var(--line); border-radius:14px; padding:10px 12px;
      display:flex; align-items:center; gap:10px; box-shadow:0 8px 22px rgba(20,32,70,.06);
      font-weight:600;
    }
    .hiw .ico{ width:26px; height:26px; border-radius:8px; background:#eef2ff; display:grid; place-items:center; font-size:14px; color:var(--brand) }
    @media (max-width:720px){ .hiw{ grid-template-columns:1fr } }

    /* Cards & layout */
    .grid{ display:grid; grid-template-columns:1.2fr .8fr; gap:18px }
    @media (max-width:900px){ .grid{ grid-template-columns:1fr } }

    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:14px; padding:14px; box-shadow:0 10px 30px rgba(20,32,70,.06);
    }
    .card h2{ margin:4px 0 10px 0; font-size:18px; font-weight:800 }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .stack{ display:grid; gap:10px }
    .two{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
    @media (max-width:520px){ .two{ grid-template-columns:1fr } }

    label{ font-size:13px; color:var(--muted) }
    input[type="number"], input[type="text"], select{
      border:1px solid var(--line); border-radius:10px; padding:10px 12px; font-family:inherit; background:#fff; width:100%;
    }

    #map{ width:100%; height:min(64vh,520px); border-radius:12px; overflow:hidden }

    .pill{
      display:inline-block; background:#eef2fa; border:1px solid var(--line);
      border-radius:999px; padding:6px 10px; font-size:12px; color:#55627a;
    }

    /* Special Abilities */
    .switch{ display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none; font-size:13px; color:var(--ink) }
    .switch input{ display:none }
    .track{ width:46px; height:26px; background:#d7deea; border-radius:999px; position:relative; transition:background .2s }
    .dot{ position:absolute; top:3px; left:3px; width:20px; height:20px; border-radius:50%; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,.2); transition:left .2s }
    .switch input:checked + .track{ background:#26a269 } .switch input:checked + .track .dot{ left:23px }
    .fineprint{ font-size:12px; color:var(--muted); }

    /* Code box + WhatsApp */
    .codeBox{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      background:#f7f9ff; border:1px dashed #c7d2ee; padding:10px 12px; border-radius:12px;
    }
    .code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-weight:800; letter-spacing:.12em }

    .whatsapp-btn{
      background:#25D366; color:#fff; border-radius:50%; width:46px; height:46px;
      display:flex; align-items:center; justify-content:center; border:none; cursor:pointer;
      box-shadow:0 4px 8px rgba(0,0,0,0.15);
    }
    .whatsapp-btn:hover{ background:#20b358 }
    .whatsapp-btn svg{ width:22px; height:22px; display:block; fill:currentColor }

    .footnote{ margin-top:8px; font-size:12px; color:var(--muted) }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div>
        <div class="brand">Seekr.run</div>
        <div class="tag">Gameplay demo ‚Äî set a zone, configure rules, get a dummy code</div>
      </div>
      <a href="index.html" class="btn secondary">Back</a>
    </header>

    <!-- How it works strip -->
    <div class="hiw" aria-label="How it works">
      <div class="chip"><span class="ico">üìç</span>Choose zone</div>
      <div class="chip"><span class="ico">üïµÔ∏è</span>Hide or Seek</div>
      <div class="chip"><span class="ico">üèÅ</span>Reach destination</div>
    </div>

    <div class="grid">
      <!-- Map and zone -->
      <section class="card">
        <h2>Pick your playing area</h2>
        <div id="map" role="img" aria-label="Select a game area on map"></div>

        <div class="two" style="margin-top:10px;">
          <div class="stack">
            <label for="radiusKm">Area radius (km)</label>
            <input id="radiusKm" type="number" min="0.2" max="50" step="0.1" value="0.6" />
          </div>
          <div class="stack">
            <label class="muted">Center (drag the pin)</label>
            <div class="pill" id="centerReadout">lat 0, lng 0</div>
          </div>
        </div>

        <div class="two" style="margin-top:10px;">
          <div class="stack">
            <label for="uncertaintyM">Last ping uncertainty (m)</label>
            <input id="uncertaintyM" type="number" min="10" max="200" step="5" value="50" />
          </div>
          <div class="row">
            <button id="btnExtract" class="btn secondary" type="button" title="Click then tap map to place">
              Set extraction point
            </button>
            <span id="extractReadout" class="pill" style="display:none;"></span>
            <button id="btnClearExtract" class="btn secondary" type="button" style="display:none;">Clear</button>
          </div>
        </div>

        <div class="footnote">Your location is used only to center this demo map.</div>
      </section>

      <!-- Rules + abilities + code -->
      <section class="card">
        <h2>Rules</h2>
        <div class="two">
          <div class="stack">
            <label for="gameLen">Game length (minutes)</label>
            <input id="gameLen" type="number" min="5" max="240" step="5" value="30" />
          </div>
          <div class="stack">
            <label for="tagDist">Tag distance (meters)</label>
            <input id="tagDist" type="number" min="2" max="50" step="1" value="8" />
          </div>
        </div>

        <div class="stack" style="margin-top:10px;">
          <label><strong>Special Abilities</strong> (optional strategy)</label>
          <label class="switch"><input id="puDelay" type="checkbox" checked><span class="track"><span class="dot"></span></span>Delay next reveal</label>
          <label class="switch"><input id="puDecoy" type="checkbox" checked><span class="track"><span class="dot"></span></span>Create a short decoy trail</label>
          <label class="switch"><input id="puReveal" type="checkbox"><span class="track"><span class="dot"></span></span>Instant reveal (seeker-only)</label>
          <div class="fineprint">Cooldowns and limits keep every match fair ‚Äî no pay-to-win.</div>
        </div>

        <div class="two" style="margin-top:10px;">
          <div class="stack">
            <label for="pingMins">Reveal ping (minutes)</label>
            <input id="pingMins" type="number" min="1" max="15" step="1" value="5" />
          </div>
          <div class="stack">
            <label>Wallet (demo)</label>
            <div class="pill"><strong>$2.59</strong> demo balance</div>
          </div>
        </div>

        <div class="stack" style="margin-top:14px;">
          <div class="codeBox">
            <div class="muted">Game code</div>
            <div id="code" class="code">AAAAAA</div>
            <button id="btnCode" class="btn" type="button">Generate</button>
            <!-- WhatsApp share -->
            <button id="btnShareWA" class="whatsapp-btn" type="button" title="Share on WhatsApp" aria-label="Share on WhatsApp">
              <svg viewBox="0 0 32 32" aria-hidden="true">
                <path d="M19.11 17.39c-.3-.15-1.77-.87-2.05-.97-.28-.1-.49-.15-.7.15s-.8.97-.98 1.17c-.18.2-.36.22-.66.07-.3-.15-1.28-.47-2.44-1.5-.9-.8-1.52-1.78-1.7-2.08-.18-.3-.02-.46.13-.61.14-.14.3-.36.45-.54.15-.18.2-.3.3-.5.1-.2.05-.37-.02-.52-.07-.15-.7-1.69-.96-2.3-.25-.6-.51-.52-.7-.53l-.6-.01c-.2 0-.52.07-.79.37-.27.3-1.04 1.02-1.04 2.49s1.07 2.89 1.22 3.09c.15.2 2.1 3.2 5.08 4.49.71.31 1.27.5 1.7.64.71.23 1.36.2 1.87.12.57-.09 1.77-.72 2.03-1.42.25-.7.25-1.29.18-1.42-.07-.13-.27-.2-.57-.35zM16 3.1c-7.12 0-12.9 5.78-12.9 12.9 0 2.28.6 4.51 1.75 6.47L3 29l6.74-1.77a12.83 12.83 0 0 0 6.26 1.6c7.12 0 12.9-5.78 12.9-12.9S23.12 3.1 16 3.1zm0 23.36c-2.15 0-4.25-.58-6.08-1.68l-.44-.26-4.02 1.06 1.08-3.92-.28-.45a10.77 10.77 0 1 1 9.74 5.25z" fill="currentColor"/>
              </svg>
            </button>
          </div>

          <button id="btnStart" class="btn" type="button">Start demo round</button>
          <div id="status" class="footnote"></div>
          <div class="footnote">Questions? <a href="index.html#faq">Check the FAQ</a>.</div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // Map setup
    let map, centerMarker, areaCircle, uncertaintyCircle, extractMarker;
    let placingExtract = false;

    const centerReadout = document.getElementById('centerReadout');
    const radiusInput = document.getElementById('radiusKm');
    const uncertaintyInput = document.getElementById('uncertaintyM');
    const btnExtract = document.getElementById('btnExtract');
    const btnClearExtract = document.getElementById('btnClearExtract');
    const extractReadout = document.getElementById('extractReadout');

    function setCenterReadout(latlng){
      centerReadout.textContent = 'lat ' + latlng.lat.toFixed(5) + ', lng ' + latlng.lng.toFixed(5);
    }

    function drawUncertainty(latlng, meters){
      if(!uncertaintyCircle){
        uncertaintyCircle = L.circle(latlng, {
          radius: meters, color:'#f59f00', weight:2, fillColor:'#f59f00', fillOpacity:0.12, dashArray:'4,6'
        }).addTo(map);
      }else{
        uncertaintyCircle.setLatLng(latlng);
        uncertaintyCircle.setRadius(meters);
      }
    }

    function initMap(lat=51.505, lng=-0.09){
      map = L.map('map', { zoomControl:true, attributionControl:false });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
      const start = L.latLng(lat, lng);
      map.setView(start, 15);

      centerMarker = L.marker(start, { draggable:true }).addTo(map);
      areaCircle = L.circle(start, { radius: Number(radiusInput.value) * 1000, color:'#1e4cff', fillColor:'#1e4cff', fillOpacity:0.12 }).addTo(map);
      setCenterReadout(start);
      drawUncertainty(start, Number(uncertaintyInput.value));

      centerMarker.on('drag', e => {
        const p = e.target.getLatLng();
        areaCircle.setLatLng(p);
        drawUncertainty(p, Number(uncertaintyInput.value));
        setCenterReadout(p);
      });

      map.on('click', e => {
        if(!placingExtract) return;
        if(!extractMarker){
          extractMarker = L.marker(e.latlng, {
            icon: L.divIcon({className:'', html:'<div style="background:#1aa84b;color:#fff;border-radius:6px;padding:4px 6px;font-weight:800;box-shadow:0 2px 6px rgba(0,0,0,.25)">üèÅ Extraction</div>'}),
            interactive:false
          }).addTo(map);
        }else{
          extractMarker.setLatLng(e.latlng);
        }
        extractReadout.style.display = 'inline-block';
        extractReadout.textContent = 'Extraction @ ' + e.latlng.lat.toFixed(5)+', '+e.latlng.lng.toFixed(5);
        btnClearExtract.style.display = 'inline-block';
        placingExtract = false;
        btnExtract.textContent = 'Move extraction point';
      });
    }

    radiusInput.addEventListener('input', () => {
      const km = Math.max(0.2, Math.min(50, Number(radiusInput.value) || 0.6));
      areaCircle.setRadius(km * 1000);
    });
    uncertaintyInput.addEventListener('input', () => {
      drawUncertainty(centerMarker.getLatLng(), Math.max(10, Math.min(200, Number(uncertaintyInput.value)||50)));
    });

    btnExtract.addEventListener('click', () => {
      placingExtract = true;
      btnExtract.textContent = 'Tap map to set';
    });
    btnClearExtract.addEventListener('click', () => {
      if(extractMarker){ map.removeLayer(extractMarker); extractMarker = null; }
      extractReadout.style.display = 'none';
      btnClearExtract.style.display = 'none';
      btnExtract.textContent = 'Set extraction point';
    });

    // Try geolocation for centering
    if (location.protocol === 'https:' && 'geolocation' in navigator){
      navigator.geolocation.getCurrentPosition(
        pos => initMap(pos.coords.latitude, pos.coords.longitude),
        ()  => initMap(),
        { enableHighAccuracy:true, maximumAge:60000, timeout:12000 }
      );
    }else{
      initMap();
    }

    // Demo logic
    const codeEl = document.getElementById('code');
    const btnCode = document.getElementById('btnCode');
    const btnStart = document.getElementById('btnStart');
    const statusEl = document.getElementById('status');

    function makeCode(len=6){
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let out = '';
      for(let i=0;i<len;i++){ out += chars[Math.floor(Math.random()*chars.length)]; }
      return out;
    }

    btnCode.addEventListener('click', () => {
      codeEl.textContent = makeCode();
      statusEl.textContent = 'New demo code created ‚Äî share this with friends';
      statusEl.style.color = 'var(--good)';
    });

    btnStart.addEventListener('click', () => {
      const cfg = {
        center: centerMarker.getLatLng(),
        radius_km: Number(radiusInput.value),
        game_minutes: Number(document.getElementById('gameLen').value),
        tag_meters: Number(document.getElementById('tagDist').value),
        ping_minutes: Number(document.getElementById('pingMins').value),
        uncertainty_m: Number(uncertaintyInput.value),
        powerups: {
          delay: document.getElementById('puDelay').checked,
          decoy: document.getElementById('puDecoy').checked,
          reveal: document.getElementById('puReveal').checked
        },
        extraction: extractMarker ? extractMarker.getLatLng() : null,
        code: codeEl.textContent
      };
      console.log('Demo config', cfg);
      statusEl.textContent = 'Demo round created ‚Äî code ' + cfg.code + (cfg.extraction ? ' ‚Äî extraction set' : '');
      statusEl.style.color = 'var(--good)';
    });

    // WhatsApp share: include code + URL param
    document.getElementById('btnShareWA').addEventListener('click', () => {
      const code = codeEl.textContent.trim();
      const url = new URL(window.location.href);
      if(code) url.searchParams.set('code', code);
      const msg = 'Join my Seekr.run demo ‚Äî code ' + code + ' ' + url.toString();
      window.open('https://wa.me/?text=' + encodeURIComponent(msg), '_blank');
    });
  </script>
</body>
</html>
